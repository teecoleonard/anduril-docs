import{_ as c,C as p,o as s,c as A,a1 as l,b as n,w as e,a as t,E as d,a2 as i,j as o}from"./chunks/framework.Dl-aaRiw.js";const B=JSON.parse('{"title":"Arquitetura - Sistema de Reajustes","description":"","frontmatter":{},"headers":[],"relativePath":"contratos/reajustes/arquitetura.md","filePath":"contratos/reajustes/arquitetura.md"}'),u={name:"contratos/reajustes/arquitetura.md"};function m(b,a,E,h,_,C){const r=p("Mermaid");return s(),A("div",null,[a[3]||(a[3]=l('<h1 id="arquitetura-sistema-de-reajustes" tabindex="-1">Arquitetura - Sistema de Reajustes <a class="header-anchor" href="#arquitetura-sistema-de-reajustes" aria-label="Permalink to &quot;Arquitetura - Sistema de Reajustes&quot;">​</a></h1><h2 id="visao-geral" tabindex="-1">Visão Geral <a class="header-anchor" href="#visao-geral" aria-label="Permalink to &quot;Visão Geral&quot;">​</a></h2><p>O sistema de reajustes permite que contratos atualizem o valor de parcelas futuras enquanto preserva boletos já gerados. A arquitetura garante consistência entre múltiplas visões dos dados: contrato, boletos e remessas CNAB.</p><h3 id="diagrama-de-fluxo-principal" tabindex="-1">Diagrama de Fluxo Principal <a class="header-anchor" href="#diagrama-de-fluxo-principal" aria-label="Permalink to &quot;Diagrama de Fluxo Principal&quot;">​</a></h3>',4)),(s(),n(i,null,{default:e(()=>[d(r,{id:"mermaid-12",class:"mermaid",graph:"flowchart%20TD%0A%20%20%20%20A%5B%22Usu%C3%A1rio%20Solicita%20Reajuste%22%5D%20--%3E%7CDefine%3A%20%C3%8Dndice%20%25%7C%20B%5B%22%E2%9A%99%EF%B8%8F%20API%3A%20POST%20%2Freajustes%22%5D%0A%20%20%20%20B%20--%3E%20C%7B%22Valida%C3%A7%C3%B5es%22%7D%0A%20%20%20%20C%20--%3E%7CID%20inv%C3%A1lido%7C%20D%5B%22%E2%9D%8C%20Erro%20404%22%5D%0A%20%20%20%20C%20--%3E%7C%C3%8Dndice%20inv%C3%A1lido%7C%20E%5B%22%E2%9D%8C%20Erro%20400%22%5D%0A%20%20%20%20C%20--%3E%7COK%7C%20F%5B%22Atualizar%20valor_parcela%22%5D%0A%20%20%20%20%0A%20%20%20%20F%20--%3E%20G%5B%22valor_parcela%20%3D%20novo_valor%22%5D%0A%20%20%20%20G%20--%3E%20H%5B%22Registrar%20indice_de_reajuste%22%5D%0A%20%20%20%20H%20--%3E%20I%5B%22data_do_ultimo_reajuste%20%3D%20Data%20atual%22%5D%0A%20%20%20%20I%20--%3E%20J%5B%22Recalcular%20saldo_devedor%22%5D%0A%20%20%20%20J%20--%3E%20K%5B%22Retornar%20contrato%20atualizado%22%5D%0A%20%20%20%20%0A%20%20%20%20style%20A%20fill%3A%23e1f5ff%0A%20%20%20%20style%20F%20fill%3A%23fff3e0%0A%20%20%20%20style%20G%20fill%3A%23f3e5f5%0A%20%20%20%20style%20K%20fill%3A%23e8f5e9%0A"})]),fallback:e(()=>[...a[0]||(a[0]=[t(" Loading... ",-1)])]),_:1})),a[4]||(a[4]=o("h2",{id:"diagrama-de-entidades",tabindex:"-1"},[t("Diagrama de Entidades "),o("a",{class:"header-anchor",href:"#diagrama-de-entidades","aria-label":'Permalink to "Diagrama de Entidades"'},"​")],-1)),(s(),n(i,null,{default:e(()=>[d(r,{id:"mermaid-16",class:"mermaid",graph:"erDiagram%0A%20%20%20%20CONTRATO%20%7C%7C--o%7B%20BOLETO%20%3A%20gera%0A%20%20%20%20CONTRATO%20%7C%7C--o%7B%20REAJUSTE%20%3A%20sofre%0A%20%20%20%20BOLETO%20%7C%7C--o%7B%20REMESSA_CNAB%20%3A%20vincula%0A%20%20%20%20%0A%20%20%20%20CONTRATO%20%7B%0A%20%20%20%20%20%20%20%20int%20id%20PK%0A%20%20%20%20%20%20%20%20string%20numero_contrato%20UK%0A%20%20%20%20%20%20%20%20decimal%20valor_parcela%20%22Valor%20de%20pr%C3%B3xima%20parcela%22%0A%20%20%20%20%20%20%20%20decimal%20saldo_devedor%20%22SUM(boletos%20abertos)%22%0A%20%20%20%20%20%20%20%20int%20quantidade_parcelas%0A%20%20%20%20%20%20%20%20int%20numero_parcela_atual%0A%20%20%20%20%20%20%20%20int%20indice_de_reajuste%20%22%25%20do%20%C3%BAltimo%20reajuste%22%0A%20%20%20%20%20%20%20%20date%20data_do_ultimo_reajuste%0A%20%20%20%20%20%20%20%20string%20status%20%22ativo%7Ccancelado%7Cfinalizado%22%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20BOLETO%20%7B%0A%20%20%20%20%20%20%20%20int%20id%20PK%0A%20%20%20%20%20%20%20%20int%20contrato_id%20FK%0A%20%20%20%20%20%20%20%20int%20numero_parcela%0A%20%20%20%20%20%20%20%20decimal%20valor_parcela%20%22Fixo%20quando%20criado%22%0A%20%20%20%20%20%20%20%20string%20status%20%22aberto%7Cliquidado%7Ccancelado%22%0A%20%20%20%20%20%20%20%20date%20data_vencimento%0A%20%20%20%20%20%20%20%20date%20data_criacao%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20REAJUSTE%20%7B%0A%20%20%20%20%20%20%20%20int%20id%20PK%0A%20%20%20%20%20%20%20%20int%20contrato_id%20FK%0A%20%20%20%20%20%20%20%20int%20indice_percentual%0A%20%20%20%20%20%20%20%20decimal%20valor_anterior%0A%20%20%20%20%20%20%20%20decimal%20valor_novo%0A%20%20%20%20%20%20%20%20date%20data_aplicacao%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20REMESSA_CNAB%20%7B%0A%20%20%20%20%20%20%20%20int%20id%20PK%0A%20%20%20%20%20%20%20%20int%20boleto_id%20FK%0A%20%20%20%20%20%20%20%20string%20codigo_retorno%0A%20%20%20%20%20%20%20%20date%20data_processamento%0A%20%20%20%20%7D%0A"})]),fallback:e(()=>[...a[1]||(a[1]=[t(" Loading... ",-1)])]),_:1})),a[5]||(a[5]=o("h2",{id:"fluxo-geracao-de-proximas-parcelas-apos-reajuste",tabindex:"-1"},[t("Fluxo: Geração de Próximas Parcelas Após Reajuste "),o("a",{class:"header-anchor",href:"#fluxo-geracao-de-proximas-parcelas-apos-reajuste","aria-label":'Permalink to "Fluxo: Geração de Próximas Parcelas Após Reajuste"'},"​")],-1)),(s(),n(i,null,{default:e(()=>[d(r,{id:"mermaid-20",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20User%0A%20%20%20%20participant%20API%0A%20%20%20%20participant%20DB%20as%20Database%0A%20%20%20%20%0A%20%20%20%20User-%3E%3EAPI%3A%20POST%20%2Fgerar-boletos%2F%7BcontratoId%7D%0A%20%20%20%20API-%3E%3EDB%3A%20SELECT%20contrato%20WHERE%20id%20%3D%20%3F%0A%20%20%20%20DB--%3E%3EAPI%3A%20valor_parcela%3D3666.66%0A%20%20%20%20%0A%20%20%20%20loop%20Para%20cada%20parcela%20a%20gerar%0A%20%20%20%20%20%20%20%20API-%3E%3EAPI%3A%20Calcular%20datas%20de%20vencimento%0A%20%20%20%20%20%20%20%20API-%3E%3EDB%3A%20INSERT%20boleto%20(valor_parcela%3D3666.66)%0A%20%20%20%20%20%20%20%20DB--%3E%3EAPI%3A%20%E2%9C%93%20Boleto%20criado%0A%20%20%20%20end%0A%20%20%20%20%0A%20%20%20%20API-%3E%3EDB%3A%20SELECT%20SUM(valor_parcela)%20FROM%20boletos%20WHERE%20status%3D'aberto'%0A%20%20%20%20DB--%3E%3EAPI%3A%2039999.92%0A%20%20%20%20API-%3E%3EDB%3A%20UPDATE%20contrato%20SET%20saldo_devedor%3D39999.92%0A%20%20%20%20DB--%3E%3EAPI%3A%20%E2%9C%93%20Saldo%20atualizado%0A%20%20%20%20%0A%20%20%20%20API--%3E%3EUser%3A%20%7B%20boletos%3A%20%5B...%5D%2C%20saldo_devedor%3A%2039999.92%20%7D%0A"})]),fallback:e(()=>[...a[2]||(a[2]=[t(" Loading... ",-1)])]),_:1})),a[6]||(a[6]=l(`<h2 id="integracao-com-outras-features" tabindex="-1">Integração com Outras Features <a class="header-anchor" href="#integracao-com-outras-features" aria-label="Permalink to &quot;Integração com Outras Features&quot;">​</a></h2><h3 id="a-geracao-de-boletos" tabindex="-1">A. Geração de Boletos <a class="header-anchor" href="#a-geracao-de-boletos" aria-label="Permalink to &quot;A. Geração de Boletos&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Contrato</span></span>
<span class="line"><span>├─ valor_parcela: 3.333,33 (Ano 1)</span></span>
<span class="line"><span>├─ Boletos 1-6: cada um recebe 3.333,33</span></span>
<span class="line"><span>├───↓ REAJUSTE +10%</span></span>
<span class="line"><span>├─ valor_parcela: 3.666,66 (Ano 2)</span></span>
<span class="line"><span>└─ Boletos 7-12: cada um recebe 3.666,66</span></span></code></pre></div><h3 id="b-cnab-geracao-de-remessas" tabindex="-1">B. CNAB (Geração de Remessas) <a class="header-anchor" href="#b-cnab-geracao-de-remessas" aria-label="Permalink to &quot;B. CNAB (Geração de Remessas)&quot;">​</a></h3><p>A remessa CNAB usa os valores que estão nos boletos (não são reajustados retroativamente):</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Remessa incluindo Boletos 1-6:</span></span>
<span class="line"><span>  Segmento P (boleto 1): 3.333,33</span></span>
<span class="line"><span>  Segmento P (boleto 2): 3.333,33</span></span>
<span class="line"><span>  Segmento P (boleto 3): 3.333,33</span></span>
<span class="line"><span>  Segmento P (boleto 4): 3.333,33</span></span>
<span class="line"><span>  Segmento P (boleto 5): 3.333,33</span></span>
<span class="line"><span>  Segmento P (boleto 6): 3.333,33</span></span>
<span class="line"><span>  ─────────────────────</span></span>
<span class="line"><span>  Soma: 19.999,98</span></span></code></pre></div><h3 id="c-liquidacao-de-boletos" tabindex="-1">C. Liquidação de Boletos <a class="header-anchor" href="#c-liquidacao-de-boletos" aria-label="Permalink to &quot;C. Liquidação de Boletos&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Boleto liquidado → saldo_devedor é recalculado automaticamente</span></span>
<span class="line"><span>  Antes: saldo_devedor = 19.999,98 (6 × 3.333,33)</span></span>
<span class="line"><span>  Liquidar boleto 1</span></span>
<span class="line"><span>  Depois: saldo_devedor = 16.666,65 (5 × 3.333,33) ✅</span></span></code></pre></div><h2 id="casos-de-erro-tratados" tabindex="-1">Casos de Erro Tratados <a class="header-anchor" href="#casos-de-erro-tratados" aria-label="Permalink to &quot;Casos de Erro Tratados&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Caso</th><th>Validação</th><th>Resposta</th></tr></thead><tbody><tr><td>Contrato não existe</td><td><code>contratoId não encontrado</code></td><td>404 Not Found</td></tr><tr><td>Contrato cancelado</td><td><code>status != &#39;ativo&#39;</code></td><td>403 Forbidden</td></tr><tr><td>Índice não é número</td><td><code>isNaN(indice)</code></td><td>400 Bad Request</td></tr><tr><td>Índice &lt; 0 ou &gt; 100</td><td><code>indice &lt; 0 OR indice &gt; 100</code></td><td>400 Bad Request</td></tr><tr><td>Novo valor = 0</td><td><code>calculado &lt;= 0</code></td><td>403 Forbidden</td></tr><tr><td>Erro no banco</td><td>Transaction falha</td><td>500 Internal Server Error</td></tr></tbody></table>`,10))])}const v=c(u,[["render",m]]);export{B as __pageData,v as default};
