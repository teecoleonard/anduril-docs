import{_ as d,C as p,o as s,c,a1 as o,b as t,w as e,a as i,E as l,a2 as r}from"./chunks/framework.Dl-aaRiw.js";const v=JSON.parse('{"title":"ğŸ—ï¸ PrincÃ­pios de Arquitetura - ERP Anduril","description":"","frontmatter":{},"headers":[],"relativePath":"PRINCIPIOS_ARQUITETURA.md","filePath":"PRINCIPIOS_ARQUITETURA.md"}'),u={name:"PRINCIPIOS_ARQUITETURA.md"};function m(A,a,h,_,g,b){const n=p("Mermaid");return s(),c("div",null,[a[7]||(a[7]=o('<h1 id="ğŸ—ï¸-principios-de-arquitetura-erp-anduril" tabindex="-1">ğŸ—ï¸ PrincÃ­pios de Arquitetura - ERP Anduril <a class="header-anchor" href="#ğŸ—ï¸-principios-de-arquitetura-erp-anduril" aria-label="Permalink to &quot;ğŸ—ï¸ PrincÃ­pios de Arquitetura - ERP Anduril&quot;">â€‹</a></h1><p><strong>Status:</strong> DocumentaÃ§Ã£o de Arquitetura<br><strong>Ãšltima atualizaÃ§Ã£o:</strong> 8 de Fevereiro de 2026</p><hr><h2 id="ğŸ¯-principios-fundamentais" tabindex="-1">ğŸ¯ PrincÃ­pios Fundamentais <a class="header-anchor" href="#ğŸ¯-principios-fundamentais" aria-label="Permalink to &quot;ğŸ¯ PrincÃ­pios Fundamentais&quot;">â€‹</a></h2><h3 id="_1-sincronizacao-automatica" tabindex="-1">1. <strong>SincronizaÃ§Ã£o AutomÃ¡tica</strong> <a class="header-anchor" href="#_1-sincronizacao-automatica" aria-label="Permalink to &quot;1. **SincronizaÃ§Ã£o AutomÃ¡tica**&quot;">â€‹</a></h3><p>O sistema sempre mantÃ©m dados sincronizados automaticamente:</p>',6)),(s(),t(r,null,{default:e(()=>[l(n,{id:"mermaid-16",class:"mermaid",graph:"graph%20LR%0A%20%20%20%20A%5BBoleto%20Muda%20de%20Status%5D%20--%3E%20B%5BEvento%20no%20BD%5D%0A%20%20%20%20B%20--%3E%20C%5BRecalcula%20saldo_devedor%5D%0A%20%20%20%20C%20--%3E%20D%5BContrato%20Atualizado%5D%0A%20%20%20%20%0A%20%20%20%20style%20A%20fill%3A%23e1f5ff%0A%20%20%20%20style%20B%20fill%3A%23fff3e0%0A%20%20%20%20style%20C%20fill%3A%23f3e5f5%0A%20%20%20%20style%20D%20fill%3A%23e8f5e9%0A"})]),fallback:e(()=>[...a[0]||(a[0]=[i(" Loading... ",-1)])]),_:1})),a[8]||(a[8]=o(`<p><strong>ImplementaÃ§Ã£o:</strong></p><ul><li>Eventos no banco de dados atualizam derivados</li><li>TransaÃ§Ãµes atÃ´micas garantem consistÃªncia</li><li>ValidaÃ§Ãµes em tempo real</li><li>Sem operaÃ§Ãµes manuais necessÃ¡rias</li></ul><hr><h3 id="_2-imutabilidade-de-transacoes" tabindex="-1">2. <strong>Imutabilidade de TransaÃ§Ãµes</strong> <a class="header-anchor" href="#_2-imutabilidade-de-transacoes" aria-label="Permalink to &quot;2. **Imutabilidade de TransaÃ§Ãµes**&quot;">â€‹</a></h3><p>Uma vez que uma transaÃ§Ã£o Ã© registrada (como um boleto), ela NUNCA muda:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Boleto criado em 01/01/2026 por R$ 3.333,33</span></span>
<span class="line"><span>    â†“ (NUNCA MUDA, MESMO COM REAJUSTE)</span></span>
<span class="line"><span>Mesmo que reajuste em 02/02/2026</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>Boleto CONTINUA R$ 3.333,33</span></span></code></pre></div><p><strong>BenefÃ­cios:</strong></p><ul><li>âœ… Auditoria clara</li><li>âœ… HistÃ³rico confiÃ¡vel</li><li>âœ… CÃ¡lculos determinÃ­sticos</li><li>âœ… Rastreabilidade completa</li></ul><p><strong>Exemplo visual:</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Contrato: CONT-001</span></span>
<span class="line"><span>â”œâ”€ Boleto #1 (Jan/2026): R$ 3.333,33 â† IMUTÃVEL</span></span>
<span class="line"><span>â”œâ”€ Boleto #2 (Fev/2026): R$ 3.333,33 â† IMUTÃVEL</span></span>
<span class="line"><span>â”œâ”€ Boleto #3 (Mar/2026): R$ 3.333,33 â† IMUTÃVEL</span></span>
<span class="line"><span>â”‚</span></span>
<span class="line"><span>â””â”€ [REAJUSTE APLICADO: +10%]</span></span>
<span class="line"><span>   â”œâ”€ Boleto #4 (Abr/2026): R$ 3.666,66 â† Nova parcela</span></span>
<span class="line"><span>   â”œâ”€ Boleto #5 (Mai/2026): R$ 3.666,66 â† Nova parcela</span></span>
<span class="line"><span>   â””â”€ Boleto #6 (Jun/2026): R$ 3.666,66 â† Nova parcela</span></span></code></pre></div><hr><h3 id="_3-dados-derivados-vs-armazenados" tabindex="-1">3. <strong>Dados Derivados vs Armazenados</strong> <a class="header-anchor" href="#_3-dados-derivados-vs-armazenados" aria-label="Permalink to &quot;3. **Dados Derivados vs Armazenados**&quot;">â€‹</a></h3><p>Distingue entre dados que sÃ£o <strong>calculados</strong> vs dados que sÃ£o <strong>armazenados</strong>:</p>`,13)),(s(),t(r,null,{default:e(()=>[l(n,{id:"mermaid-86",class:"mermaid",graph:"graph%20TD%0A%20%20%20%20A%5BDados%20no%20Banco%5D%20--%3E%20B%7BTipo%3F%7D%0A%20%20%20%20B%20--%3E%7CArmazenado%7C%20C%5BValor%20Base%5D%0A%20%20%20%20B%20--%3E%7CDerivado%7C%20D%5BCalculado%5D%0A%20%20%20%20%0A%20%20%20%20C%20--%3E%20E%5B%22valor_parcela%3Cbr%2F%3Eindice_de_reajuste%3Cbr%2F%3Edata_ultimo_reajuste%22%5D%0A%20%20%20%20D%20--%3E%20F%5B%22saldo_devedor%3Cbr%2F%3Equantidade_restante%3Cbr%2F%3Eproxima_data_vencimento%22%5D%0A%20%20%20%20%0A%20%20%20%20style%20C%20fill%3A%23fff3e0%0A%20%20%20%20style%20D%20fill%3A%23f3e5f5%0A"})]),fallback:e(()=>[...a[1]||(a[1]=[i(" Loading... ",-1)])]),_:1})),a[9]||(a[9]=o('<p><strong>Dados Armazenados (no BD):</strong></p><ul><li><code>valor_parcela</code> - Valor base do contrato/boleto</li><li><code>indice_de_reajuste</code> - % de reajuste anual</li><li><code>data_ultimo_reajuste</code> - Quando foi reajustado</li><li><code>data_vencimento</code> - Data prevista de pagamento</li></ul><p><strong>Dados Derivados (calculados):</strong></p><ul><li><code>saldo_devedor</code> = SUM(boletos onde status = &#39;aberto&#39;)</li><li><code>quantidade_restante</code> = COUNT(boletos onde status = &#39;aberto&#39;)</li><li><code>dias_em_atraso</code> = TODAY() - data_vencimento</li><li><code>valor_total</code> = valor_parcela Ã— quantidade_parcelas</li></ul><hr><h2 id="ğŸ”„-fluxos-principais" tabindex="-1">ğŸ”„ Fluxos Principais <a class="header-anchor" href="#ğŸ”„-fluxos-principais" aria-label="Permalink to &quot;ğŸ”„ Fluxos Principais&quot;">â€‹</a></h2><h3 id="fluxo-criar-contrato" tabindex="-1">Fluxo: Criar Contrato <a class="header-anchor" href="#fluxo-criar-contrato" aria-label="Permalink to &quot;Fluxo: Criar Contrato&quot;">â€‹</a></h3>',7)),(s(),t(r,null,{default:e(()=>[l(n,{id:"mermaid-144",class:"mermaid",graph:"graph%20LR%0A%20%20%20%20A%5BNovo%20Contrato%5D%20--%3E%20B%5BSalva%20em%20BD%5D%0A%20%20%20%20B%20--%3E%20C%5BGera%20Boleto%20%231%5D%0A%20%20%20%20C%20--%3E%20D%5BRecalcula%20saldo_devedor%5D%0A%20%20%20%20D%20--%3E%20E%5BContrato%20Pronto%5D%0A%20%20%20%20%0A%20%20%20%20style%20A%20fill%3A%23e1f5ff%0A%20%20%20%20style%20E%20fill%3A%23e8f5e9%0A"})]),fallback:e(()=>[...a[2]||(a[2]=[i(" Loading... ",-1)])]),_:1})),a[10]||(a[10]=o('<p><strong>Dados de entrada:</strong></p><ul><li><code>numero_contrato</code> (Ãºnico)</li><li><code>valor_parcela</code></li><li><code>quantidade_parcelas</code></li><li><code>data_primeira_parcela</code></li><li><code>cliente_id</code></li></ul><hr><h3 id="fluxo-reajustar-contrato" tabindex="-1">Fluxo: Reajustar Contrato <a class="header-anchor" href="#fluxo-reajustar-contrato" aria-label="Permalink to &quot;Fluxo: Reajustar Contrato&quot;">â€‹</a></h3>',4)),(s(),t(r,null,{default:e(()=>[l(n,{id:"mermaid-179",class:"mermaid",graph:"graph%20TD%0A%20%20%20%20A%5BReajuste%20Solicitado%3Cbr%2F%3E10%25%20de%20aumento%5D%20--%3E%20B%5BValida%20reajuste%5D%0A%20%20%20%20B%20--%3E%20C%5BAtualiza%20valor_parcela%5D%0A%20%20%20%20C%20--%3E%20D%5BBoletos%20antigos%20PERMANECEM%3Cbr%2F%3Ecom%20valor%20original%5D%0A%20%20%20%20D%20--%3E%20E%5BGera%20novo%20boleto%20com%3Cbr%2F%3Enovo%20valor_parcela%5D%0A%20%20%20%20E%20--%3E%20F%5BSincroniza%20saldo_devedor%5D%0A%20%20%20%20%0A%20%20%20%20style%20A%20fill%3A%23fff3e0%0A%20%20%20%20style%20F%20fill%3A%23e8f5e9%0A"})]),fallback:e(()=>[...a[3]||(a[3]=[i(" Loading... ",-1)])]),_:1})),a[11]||(a[11]=o('<p><strong>O que muda:</strong></p><ul><li><code>valor_parcela</code> aumenta</li><li><code>data_ultimo_reajuste</code> atualizada</li><li>Novos boletos usam novo valor</li><li>Boletos existentes nÃ£o mudam</li></ul><p><strong>O que NÃƒO muda:</strong></p><ul><li>Boletos jÃ¡ emitidos</li><li>Boletos jÃ¡ pagos</li><li>HistÃ³rico de transaÃ§Ãµes</li></ul><hr><h3 id="fluxo-importar-retorno-cnab" tabindex="-1">Fluxo: Importar Retorno CNAB <a class="header-anchor" href="#fluxo-importar-retorno-cnab" aria-label="Permalink to &quot;Fluxo: Importar Retorno CNAB&quot;">â€‹</a></h3>',6)),(s(),t(r,null,{default:e(()=>[l(n,{id:"mermaid-229",class:"mermaid",graph:"graph%20LR%0A%20%20%20%20A%5BArquivo%20Retorno%3Cbr%2F%3EBanco%5D%20--%3E%20B%5BParse%20do%20arquivo%5D%0A%20%20%20%20B%20--%3E%20C%5BAtualiza%20status%20boleto%5D%0A%20%20%20%20C%20--%3E%20D%5BRecalcula%20saldo_devedor%5D%0A%20%20%20%20D%20--%3E%20E%5BSincroniza%20Contrato%5D%0A%20%20%20%20E%20--%3E%20F%5BFim%5D%0A%20%20%20%20%0A%20%20%20%20style%20A%20fill%3A%23ffe0b2%0A%20%20%20%20style%20F%20fill%3A%23e8f5e9%0A"})]),fallback:e(()=>[...a[4]||(a[4]=[i(" Loading... ",-1)])]),_:1})),a[12]||(a[12]=o(`<p><strong>Dados atualizados:</strong></p><ul><li><code>status</code> do boleto (ligado â†’ pago)</li><li><code>data_pagamento</code></li><li><code>valor_pago</code></li><li><code>saldo_devedor</code> recalculado automaticamente</li></ul><hr><h2 id="ğŸ“Š-estrutura-de-dados" tabindex="-1">ğŸ“Š Estrutura de Dados <a class="header-anchor" href="#ğŸ“Š-estrutura-de-dados" aria-label="Permalink to &quot;ğŸ“Š Estrutura de Dados&quot;">â€‹</a></h2><h3 id="tabela-contratos" tabindex="-1">Tabela: Contratos <a class="header-anchor" href="#tabela-contratos" aria-label="Permalink to &quot;Tabela: Contratos&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>contrato</span></span>
<span class="line"><span>â”œâ”€ id (PK)</span></span>
<span class="line"><span>â”œâ”€ numero_contrato (UNIQUE)</span></span>
<span class="line"><span>â”œâ”€ valor_parcela (DECIMAL) â† MUDA com reajuste</span></span>
<span class="line"><span>â”œâ”€ indice_de_reajuste (DECIMAL) â† % anual</span></span>
<span class="line"><span>â”œâ”€ data_ultimo_reajuste (DATE)</span></span>
<span class="line"><span>â”œâ”€ quantidade_parcelas (INT) â† Original</span></span>
<span class="line"><span>â”œâ”€ saldo_devedor (DECIMAL) â† DERIVADO</span></span>
<span class="line"><span>â”œâ”€ cliente_id (FK)</span></span>
<span class="line"><span>â””â”€ timestamps</span></span></code></pre></div><h3 id="tabela-boletos" tabindex="-1">Tabela: Boletos <a class="header-anchor" href="#tabela-boletos" aria-label="Permalink to &quot;Tabela: Boletos&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>boleto</span></span>
<span class="line"><span>â”œâ”€ id (PK)</span></span>
<span class="line"><span>â”œâ”€ contrato_id (FK)</span></span>
<span class="line"><span>â”œâ”€ valor_parcela (DECIMAL) â† IMUTÃVEL</span></span>
<span class="line"><span>â”œâ”€ status (ENUM: aberto/pago/vencido)</span></span>
<span class="line"><span>â”œâ”€ data_vencimento (DATE)</span></span>
<span class="line"><span>â”œâ”€ data_pagamento (DATE ou NULL)</span></span>
<span class="line"><span>â”œâ”€ valor_pago (DECIMAL)</span></span>
<span class="line"><span>â””â”€ timestamps</span></span></code></pre></div><hr><h2 id="âœ¨-caracteristicas-principais" tabindex="-1">âœ¨ CaracterÃ­sticas Principais <a class="header-anchor" href="#âœ¨-caracteristicas-principais" aria-label="Permalink to &quot;âœ¨ CaracterÃ­sticas Principais&quot;">â€‹</a></h2><h3 id="sincronizacao-automatica" tabindex="-1">SincronizaÃ§Ã£o AutomÃ¡tica <a class="header-anchor" href="#sincronizacao-automatica" aria-label="Permalink to &quot;SincronizaÃ§Ã£o AutomÃ¡tica&quot;">â€‹</a></h3><p>Toda mudanÃ§a no boleto (via CNAB ou manual) atualiza a contagem de saldo:</p>`,12)),(s(),t(r,null,{default:e(()=>[l(n,{id:"mermaid-277",class:"mermaid",graph:"graph%20LR%0A%20%20%20%20A%5BBoleto%20Status%3A%20aberto%E2%86%92pago%5D%20--%3E%7CTrigger%20BD%7C%20B%5BRecalcula%20saldo_devedor%5D%0A%20%20%20%20B%20--%3E%7CAtualiza%20contrato%7C%20C%5BContrato%20sempre%20sincronizado%5D%0A%20%20%20%20%0A%20%20%20%20style%20A%20fill%3A%23ffccbc%0A%20%20%20%20style%20C%20fill%3A%23c8e6c9%0A"})]),fallback:e(()=>[...a[5]||(a[5]=[i(" Loading... ",-1)])]),_:1})),a[13]||(a[13]=o(`<h3 id="validacoes-em-cascata" tabindex="-1">ValidaÃ§Ãµes em Cascata <a class="header-anchor" href="#validacoes-em-cascata" aria-label="Permalink to &quot;ValidaÃ§Ãµes em Cascata&quot;">â€‹</a></h3><p>Cada operaÃ§Ã£o passa por validaÃ§Ãµes:</p><ol><li><strong>ValidaÃ§Ã£o de Entrada</strong> - Dados corretos?</li><li><strong>ValidaÃ§Ã£o de NegÃ³cio</strong> - Regras atendidas?</li><li><strong>ValidaÃ§Ã£o de Estado</strong> - Sistema pode fazer isso agora?</li><li><strong>ValidaÃ§Ã£o Transacional</strong> - Todas as mudanÃ§as consistentes?</li></ol><hr><h2 id="ğŸ”’-seguranca-de-dados" tabindex="-1">ğŸ”’ SeguranÃ§a de Dados <a class="header-anchor" href="#ğŸ”’-seguranca-de-dados" aria-label="Permalink to &quot;ğŸ”’ SeguranÃ§a de Dados&quot;">â€‹</a></h2><h3 id="principios-de-seguranca" tabindex="-1">PrincÃ­pios de SeguranÃ§a <a class="header-anchor" href="#principios-de-seguranca" aria-label="Permalink to &quot;PrincÃ­pios de SeguranÃ§a&quot;">â€‹</a></h3><ul><li>âœ… TransaÃ§Ãµes atÃ´micas (tudo ou nada)</li><li>âœ… Sem deleÃ§Ã£o de histÃ³rico (soft delete)</li><li>âœ… Auditoria completa de mudanÃ§as</li><li>âœ… ValidaÃ§Ã£o dupla (BD + API)</li><li>âœ… Isolamento de dados por tenant</li></ul><h3 id="exemplo-seguranca-em-reajuste" tabindex="-1">Exemplo: SeguranÃ§a em Reajuste <a class="header-anchor" href="#exemplo-seguranca-em-reajuste" aria-label="Permalink to &quot;Exemplo: SeguranÃ§a em Reajuste&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. API recebe pedido de reajuste</span></span>
<span class="line"><span>2. Valida se contrato existe</span></span>
<span class="line"><span>3. Calcula novo valor_parcela</span></span>
<span class="line"><span>4. Abre transaÃ§Ã£o no BD</span></span>
<span class="line"><span>5. Atualiza valor_parcela</span></span>
<span class="line"><span>6. Atualiza data_ultimo_reajuste</span></span>
<span class="line"><span>7. Gera novo boleto (com novo valor)</span></span>
<span class="line"><span>8. Recalcula saldo_devedor</span></span>
<span class="line"><span>9. Confirma transaÃ§Ã£o</span></span>
<span class="line"><span>10. Se erro em qualquer passo â†’ tudo reverte</span></span></code></pre></div><hr><h2 id="ğŸ“ˆ-padrao-de-design" tabindex="-1">ğŸ“ˆ PadrÃ£o de Design <a class="header-anchor" href="#ğŸ“ˆ-padrao-de-design" aria-label="Permalink to &quot;ğŸ“ˆ PadrÃ£o de Design&quot;">â€‹</a></h2><h3 id="repository-pattern" tabindex="-1">Repository Pattern <a class="header-anchor" href="#repository-pattern" aria-label="Permalink to &quot;Repository Pattern&quot;">â€‹</a></h3><p>Acesso a dados centralizado:</p>`,13)),(s(),t(r,null,{default:e(()=>[l(n,{id:"mermaid-354",class:"mermaid",graph:"graph%20LR%0A%20%20%20%20A%5BController%5D%20--%3E%20B%5BService%5D%0A%20%20%20%20B%20--%3E%20C%5BRepository%5D%0A%20%20%20%20C%20--%3E%20D%5BBanco%20de%20Dados%5D%0A%20%20%20%20%0A%20%20%20%20style%20A%20fill%3A%23e3f2fd%0A%20%20%20%20style%20B%20fill%3A%23f3e5f5%0A%20%20%20%20style%20C%20fill%3A%23ffe0b2%0A%20%20%20%20style%20D%20fill%3A%23fce4ec%0A"})]),fallback:e(()=>[...a[6]||(a[6]=[i(" Loading... ",-1)])]),_:1})),a[14]||(a[14]=o(`<h3 id="service-pattern" tabindex="-1">Service Pattern <a class="header-anchor" href="#service-pattern" aria-label="Permalink to &quot;Service Pattern&quot;">â€‹</a></h3><p>LÃ³gica de negÃ³cio isolada:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ContratoService</span></span>
<span class="line"><span>â”œâ”€ criar(dados)</span></span>
<span class="line"><span>â”œâ”€ reajustar(id, percentual)</span></span>
<span class="line"><span>â”œâ”€ sincronizarSaldo(id)</span></span>
<span class="line"><span>â”œâ”€ listar()</span></span>
<span class="line"><span>â””â”€ obter(id)</span></span></code></pre></div><hr><h2 id="ğŸ¯-resumo-dos-principios" tabindex="-1">ğŸ¯ Resumo dos PrincÃ­pios <a class="header-anchor" href="#ğŸ¯-resumo-dos-principios" aria-label="Permalink to &quot;ğŸ¯ Resumo dos PrincÃ­pios&quot;">â€‹</a></h2><table tabindex="0"><thead><tr><th>PrincÃ­pio</th><th>BenefÃ­cio</th></tr></thead><tbody><tr><td>SincronizaÃ§Ã£o AutomÃ¡tica</td><td>Sempre consistente</td></tr><tr><td>Imutabilidade de TransaÃ§Ãµes</td><td>Auditoria clara</td></tr><tr><td>Dados Derivados</td><td>Sem cÃ¡lculos incorretos</td></tr><tr><td>TransaÃ§Ãµes AtÃ´micas</td><td>Tudo ou nada</td></tr><tr><td>ValidaÃ§Ã£o em Cascata</td><td>MÃ¡xima seguranÃ§a</td></tr></tbody></table><hr><p><em>Ãšltima atualizaÃ§Ã£o: 8 de Fevereiro de 2026</em></p>`,8))])}const C=d(u,[["render",m]]);export{v as __pageData,C as default};
